{"version":3,"sources":["webpack:///./src/modules/js/api.js","webpack:///./src/modules/js/mixin.js","webpack:///./src/modules/js/fetch.js","webpack:///./src/modules/js/cartService.js","webpack:///./src/pages/cart/cart.js"],"names":["url","hotLists","banner","topList","subList","rank","searchList","details","deal","cartAdd","cartLists","cartReduce","cartRemove","cartMremove","key","hasOwnProperty","__webpack_exports__","filters","currency","price","priceStr","indexOf","arr","split","substr","js_fetch","data","promise_default","a","resolve","reject","axios_default","post","then","res","status","location","href","catch","error","cartService","id","api","number","ids","forEach","goods","push","vue_esm","el","lists","total","editingShop","editingShopIndex","removePopup","removeData","removeMsg","computed","allSelected","get","this","length","every","shop","checked","set","newVal","goodsList","allRemoveSelected","removeChecked","selectLists","removeLists","created","getLists","methods","_this","cartList","editing","editingMsg","e","console","log","selectGoods","attr","selectShop","selectAll","edit","shopIndex","item","i","reduce","add","remove","goodsIndex","removeList","removeConfirm","_this2","_removeData","splice","removeShop","findIndex","start","startX","changedTouches","clientX","end","endX","left","velocity_default","$refs","mixins","mixin"],"mappings":"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","file":"static/js/cart.0fc2107f3bdd63e259f0.js","sourcesContent":["let url = {\r\n    hotLists: '/index/hotLists',\r\n    banner: '/index/banner',\r\n    topList: '/category/topList',\r\n    subList: '/category/subList',\r\n    rank: '/category/rank',\r\n    searchList: '/search/list',\r\n    details: '/goods/details',\r\n    deal: '/goods/deal',\r\n    cartAdd: '/cart/add',\r\n    cartLists: '/cart/list',\r\n    cartReduce: '/cart/reduce',\r\n    cartRemove: '/cart/remove',\r\n    cartMremove: '/cart/mremove',\r\n}\r\n\r\nlet host = 'http://rapapi.org/mockjsdata/24170'\r\n\r\nfor (let key in url) {\r\n    if (url.hasOwnProperty(key)) {\r\n        url[key] = host + url[key]\r\n\r\n    }\r\n}\r\n\r\nexport default url\n\n\n// WEBPACK FOOTER //\n// ./src/modules/js/api.js","let mixin = {\r\n    filters: {\r\n        currency(price) {\r\n            let priceStr = '' + price\r\n            if (priceStr.indexOf('.') > -1) {\r\n                let arr = priceStr.split('.')\r\n                return arr[0] + '.' + (arr[1] + '0').substr(0, 2)\r\n            } else {\r\n                return priceStr + '.00'\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default mixin\n\n\n// WEBPACK FOOTER //\n// ./src/modules/js/mixin.js","import axios from 'axios'\r\n\r\nfunction fetch(url, data) {\r\n    return new Promise((resolve, reject) => {\r\n        axios.post(url, data).then(res => {\r\n            let status = res.data.status\r\n            if (status === 200) {\r\n                resolve(res)\r\n            }\r\n            if (status === 300) {\r\n                location.href = 'login.html'\r\n                resolve(res)\r\n            }\r\n            reject(res)\r\n        }).catch(error => {\r\n            reject(error)\r\n        })\r\n    })\r\n}\r\n\r\nexport default fetch\n\n\n// WEBPACK FOOTER //\n// ./src/modules/js/fetch.js","import fetch from 'js/fetch.js'\r\nimport url from 'js/api.js'\r\n\r\nclass Cart {\r\n    static add(id) {\r\n        return fetch(url.cartAdd, {\r\n            id,\r\n            number: 1\r\n        })\r\n    }\r\n\r\n    static reduce(id) {\r\n        return fetch(url.cartReduce, {\r\n            id,\r\n            number: 1\r\n        })\r\n    }\r\n\r\n    static remove(arr) {\r\n        let ids = []\r\n        arr.forEach(goods => {\r\n            ids.push(goods.id)\r\n        })\r\n    }\r\n}\r\n\r\nexport default Cart\n\n\n// WEBPACK FOOTER //\n// ./src/modules/js/cartService.js","import './cart_base.css'\r\nimport './cart_trade.css'\r\nimport './cart.css'\r\n\r\n\r\n// import Mock from 'mockjs'\r\n// let Random = Mock.Random\r\n\r\n// let data = Mock.mock({\r\n//   'cartList|3' :[{\r\n//     'goodsList|1-2' : [{\r\n//       id: Random.int(10000,100000),\r\n//       image: Mock.mock('@img(90x90,@color)')\r\n//     }]\r\n//   }]\r\n// })   本地模拟数据\r\n\r\nimport Vue from 'vue';\r\nimport axios from 'axios';\r\nimport mixin from 'js/mixin.js';\r\nimport url from 'js/api.js';\r\nimport Velocity from 'velocity-animate';\r\n\r\nimport Cart from 'js/cartService.js'\r\nimport fetch from 'js/fetch.js'\r\n\r\n\r\nnew Vue({\r\n    el: '.container',\r\n    data: {\r\n        lists: null,\r\n        total: 0,\r\n        editingShop: null, //正在编辑的店铺\r\n        editingShopIndex: -1, //编辑店铺的id\r\n        removePopup: false, //是否删除商品\r\n        removeData: null,\r\n        removeMsg: ''\r\n    },\r\n    computed: {\r\n        allSelected: {\r\n            get() {\r\n                if (this.lists && this.lists.length) {\r\n                    return this.lists.every(shop => {\r\n                        return shop.checked\r\n                    })\r\n                }\r\n                return false\r\n            }, //获取全选按钮选择状态\r\n            set(newVal) { //取消全选状态\r\n                this.lists.forEach(shop => {\r\n                    shop.checked = newVal\r\n                    shop.goodsList.forEach(goods => {\r\n                        goods.checked = newVal\r\n                    })\r\n                })\r\n            }\r\n        },\r\n        allRemoveSelected: {\r\n            get() {\r\n                if (this.editingShop) {\r\n                    return this.editingShop.removeChecked\r\n                }\r\n                return false\r\n            },\r\n            set(newVal) {\r\n                if (this.editingShop) {\r\n                    this.editingShop.removeChecked = newVal\r\n                    this.editingShop.goodsList.forEach(goods => {\r\n                        goods.removeChecked = newVal\r\n                    })\r\n                }\r\n            }\r\n        },\r\n        selectLists() { //计算勾选商品的总价\r\n            if (this.lists && this.lists.length) {\r\n                let arr = []\r\n                let total = 0\r\n                this.lists.forEach(shop => {\r\n                    shop.goodsList.forEach(goods => {\r\n                        if (goods.checked) {\r\n                            arr.push(goods)\r\n                            total = total + goods.price * goods.number\r\n                        }\r\n                    })\r\n                })\r\n                this.total = total\r\n                return arr\r\n            }\r\n            return []\r\n        },\r\n        removeLists() {\r\n            if (this.editingShop) {\r\n                let arr = []\r\n                this.editingShop.goodsList.forEach(goods => {\r\n                    if (goods.removeChecked) {\r\n                        arr.push(goods)\r\n                    }\r\n                })\r\n                return arr\r\n            }\r\n            return []\r\n        }\r\n    },\r\n    created() {\r\n        this.getLists()\r\n    },\r\n    methods: {\r\n        getLists() {\r\n            axios.post(url.cartLists).then(res => {\r\n\r\n                let lists = res.data.cartList\r\n                    // console.log(lists);\r\n                lists.forEach(shop => {\r\n                    shop.checked = true //勾选所有店铺\r\n                    shop.editing = false //店铺内的商品是否在编辑状态\r\n                    shop.removeChecked = false //编辑状态下的店铺勾选状态\r\n                    shop.editingMsg = '编辑' //\r\n                    shop.goodsList.forEach(goods => {\r\n                        goods.checked = true //勾选所有商品\r\n                        goods.removeChecked = false //编辑状态下的商品勾选状态\r\n                    });\r\n                }); //先处理响应的数据，再赋值\r\n                this.lists = lists\r\n\r\n            }).catch(e => console.log(e))\r\n        },\r\n        selectGoods(shop, goods) { //商品选择状态\r\n            // console.log(goods.checked);\r\n            let attr = this.editingShop ? 'removeChecked' : 'checked' //判断店铺什么情况下 removeChecked编辑状态，checked正常显示状态\r\n            goods[attr] = !goods[attr]\r\n            shop[attr] = shop.goodsList.every(goods => {\r\n                return goods[attr]\r\n            })\r\n        },\r\n        selectShop(shop) { //店铺选择状态\r\n            let attr = this.editingShop ? 'removeChecked' : 'checked'\r\n            shop[attr] = !shop[attr]\r\n            shop.goodsList.forEach(goods => {\r\n                goods[attr] = shop[attr] //当店铺选择状态发生改变时，所属的商品选择状态也随之变化\r\n            })\r\n        },\r\n        selectAll() {\r\n            let attr = this.editingShop ? 'allRemoveSelected' : 'allSelected'\r\n            this[attr] = !this[attr]\r\n        },\r\n        edit(shop, shopIndex) {\r\n            shop.editing = !shop.editing\r\n            shop.editingMsg = shop.editing ? '完成' : '编辑'\r\n            this.lists.forEach((item, i) => {\r\n                if (shopIndex !== i) {\r\n                    item.editing = false\r\n                    item.editingMsg = shop.editing ? '' : '编辑'\r\n                }\r\n            })\r\n            this.editingShop = shop.editing ? shop : null //获取编辑店铺商品时的店铺\r\n            this.editingShopIndex = shop.editing ? shopIndex : -1 //获取编辑店铺商品时的店铺id\r\n        },\r\n        reduce(goods) {\r\n            if (goods.number === 1) return\r\n                // axios.post(url.cartReduce, {\r\n                //     id: goods.id,\r\n                //     number: 1\r\n                // }).then(res => {\r\n                //     goods.number--\r\n                // })\r\n            Cart.reduce(goods.id).then(res => {\r\n                goods.number--\r\n            })\r\n\r\n        },\r\n        add(goods) {\r\n            // axios.post(url.cartAdd, {\r\n            //         id: goods.id,\r\n            //         number: 1\r\n            //     }).then(res => {\r\n            //         goods.number++\r\n            //     })\r\n            Cart.add(goods.id).then(res => {\r\n                goods.number++\r\n            })\r\n        },\r\n        remove(shop, shopIndex, goods, goodsIndex) {\r\n            this.removePopup = true\r\n            this.removeData = {\r\n                shop,\r\n                shopIndex,\r\n                goods,\r\n                goodsIndex\r\n            }\r\n            this.removeMsg = '确定要删除该商品吗？'\r\n\r\n        },\r\n        removeList() {\r\n            console.log(1);\r\n            this.removePopup = true\r\n            this.removeMsg = `确定将所选 ${this.removeLists.length} 个商品删除？`\r\n        },\r\n        removeConfirm() {\r\n            if (this.removeMsg === '确定要删除该商品吗？') {\r\n                let {\r\n                    shop,\r\n                    shopIndex,\r\n                    goods,\r\n                    goodsIndex\r\n                } = this.removeData\r\n                axios.post(url.cartRemove, {\r\n                    id: goods.id\r\n                }).then(res => {\r\n                    shop.goodsList.splice(goodsIndex, 1)\r\n                    if (!shop.goodsList.length) {\r\n                        this.lists.splice(shopIndex, 1)\r\n                        this.removeShop()\r\n                    }\r\n                    this.removePopup = false\r\n                        //可解决左滑商品删除后，该商品之后的商品自动出现往左偏移的问题。但是用key解决更好\r\n                        //this.$refs[`goods-${shopIndex}-${goodsIndex}`][0].style.left = '0px'\r\n\r\n                })\r\n            } else {\r\n                let ids = []\r\n                this.removeLists.forEach(goods => {\r\n                    ids.push(goods.id)\r\n                })\r\n                axios.post(url.cartMremove, {\r\n                    ids\r\n                }).then(res => {\r\n                    let arr = []\r\n                    this.editingShop.goodsList.forEach(goods => {\r\n                        let index = this.removeLists.findIndex(item => {\r\n                            return item.id == goods.id\r\n                        })\r\n                        if (index === -1) {\r\n                            arr.push(goods)\r\n                        }\r\n                    })\r\n                    if (arr.length) {\r\n                        this.editingShop.goodsList = arr\r\n                    } else {\r\n                        this.lists.splice(this.editingShopIndex, 1)\r\n                        this.removeShop()\r\n                    }\r\n                    this.removePopup = false\r\n                })\r\n            }\r\n        },\r\n        removeShop() {\r\n            this.editingShop = null\r\n            this.editingShopIndex = -1\r\n            this.lists.forEach(shop => { //删除店铺的同时需要把其他店铺的状态改为正常显示\r\n                shop.editing = false\r\n                shop.editingMsg = '编辑'\r\n            })\r\n        },\r\n        start(e, goods) {\r\n            goods.startX = e.changedTouches[0].clientX\r\n        },\r\n        end(e, shopIndex, goods, goodsIndex) {\r\n            let endX = e.changedTouches[0].clientX\r\n            let left = '0'\r\n            if (goods.startX - endX > 100) {\r\n                left = '-60px'\r\n            }\r\n            if (endX - goods.startX > 100) {\r\n                left = '0px' //使用Velocity必须要带上单位，否则无效\r\n            }\r\n            //console.log(this.$refs[`goods-${shopIndex}-${goodsIndex}`]);\r\n            Velocity(this.$refs[`goods-${shopIndex}-${goodsIndex}`], {\r\n                left\r\n            })\r\n\r\n        }\r\n    },\r\n    mixins: [mixin]\r\n})\n\n\n// WEBPACK FOOTER //\n// ./src/pages/cart/cart.js"],"sourceRoot":""}